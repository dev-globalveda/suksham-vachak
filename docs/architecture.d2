# Suksham Vachak - System Architecture
# Simplified, readable layout

direction: down

# Global styling
style: {
  fill: "#fafafa"
}

# ============================================
# INPUT LAYER
# ============================================
input: {
  label: "INPUT"
  style: {
    fill: "#e3f2fd"
    stroke: "#1976d2"
    border-radius: 12
    font-size: 16
    bold: true
  }

  cricsheet: "Cricsheet JSON\n(ball-by-ball data)" {
    shape: document
    style: {
      fill: "#bbdefb"
      stroke: "#1565c0"
      font-size: 14
    }
  }
}

# ============================================
# PARSER
# ============================================
parser: "Cricket Parser\n→ CricketEvent objects" {
  shape: hexagon
  style: {
    fill: "#fff3e0"
    stroke: "#ef6c00"
    font-size: 14
  }
}

# ============================================
# CONTEXT BUILDER (Main Intelligence)
# ============================================
context: {
  label: "CONTEXT BUILDER"
  style: {
    fill: "#fff8e1"
    stroke: "#f9a825"
    stroke-width: 3
    border-radius: 16
    font-size: 18
    bold: true
  }

  grid-columns: 2

  match: "Match Situation\n• Score, overs, phase\n• Target, required rate\n• Balls remaining" {
    style: {
      fill: "#fffde7"
      stroke: "#fbc02d"
      font-size: 12
    }
  }

  player: "Player Context\n• Batter: runs, SR, form\n• Bowler: spell, economy\n• Partnership stats" {
    style: {
      fill: "#fffde7"
      stroke: "#fbc02d"
      font-size: 12
    }
  }

  pressure: "Pressure Calculator\n• Phase-based (0.2-0.5)\n• Chase pressure\n• Wicket clusters\n• Dot ball tension" {
    style: {
      fill: "#fff9c4"
      stroke: "#f9a825"
      font-size: 12
    }
  }

  narrative: "Narrative Tracker\n• Storylines\n• Momentum shifts\n• Milestones approaching\n• Dramatic potential" {
    style: {
      fill: "#fff9c4"
      stroke: "#f9a825"
      font-size: 12
    }
  }
}

rich: "RichContext\nto_prompt_context()" {
  shape: parallelogram
  style: {
    fill: "#f3e5f5"
    stroke: "#7b1fa2"
    font-size: 14
    bold: true
  }
}

# ============================================
# COMMENTARY ENGINE
# ============================================
commentary: {
  label: "COMMENTARY ENGINE"
  style: {
    fill: "#ede7f6"
    stroke: "#5e35b1"
    stroke-width: 3
    border-radius: 16
    font-size: 18
    bold: true
  }

  grid-columns: 3

  benaud: "BENAUD\nMinimalist\n\"Four.\"" {
    style: {
      fill: "#f5f5dc"
      stroke: "#8d6e63"
      font-size: 13
    }
  }

  greig: "GREIG\nDramatic\n\"Tremendous!\"" {
    style: {
      fill: "#ffcdd2"
      stroke: "#c62828"
      font-size: 13
    }
  }

  doshi: "DOSHI\nHindi\n\"शानदार!\"" {
    style: {
      fill: "#ffe0b2"
      stroke: "#e65100"
      font-size: 13
    }
  }

  llm: "Claude LLM\n(Haiku/Sonnet)" {
    shape: cylinder
    style: {
      fill: "#d1c4e9"
      stroke: "#512da8"
      font-size: 13
    }
  }
}

# ============================================
# TTS ENGINE
# ============================================
tts: {
  label: "TTS ENGINE"
  style: {
    fill: "#e0f2f1"
    stroke: "#00897b"
    stroke-width: 3
    border-radius: 16
    font-size: 18
    bold: true
  }

  grid-columns: 3

  voices: "Voice Mapping\nen-AU (Benaud)\nen-GB (Greig)\nhi-IN (Doshi)" {
    style: {
      fill: "#b2dfdb"
      stroke: "#00796b"
      font-size: 12
    }
  }

  prosody: "Prosody Control\nWicket → pause\nSix → excited\nDot → subdued" {
    style: {
      fill: "#b2dfdb"
      stroke: "#00796b"
      font-size: 12
    }
  }

  google: "Google Cloud\nWaveNet TTS" {
    shape: cloud
    style: {
      fill: "#80cbc4"
      stroke: "#00695c"
      font-size: 12
    }
  }
}

# ============================================
# OUTPUT
# ============================================
output: "AUDIO OUTPUT\nMP3 / Base64 stream" {
  shape: oval
  style: {
    fill: "#c8e6c9"
    stroke: "#2e7d32"
    font-size: 16
    bold: true
  }
}

# ============================================
# FUTURE: RAG
# ============================================
future: "PHASE 3: Déjà Vu Engine\n(Vector DB + Historical Retrieval)" {
  style: {
    fill: "#f5f5f5"
    stroke: "#9e9e9e"
    stroke-dash: 5
    font-size: 12
    italic: true
  }
}

# ============================================
# CONNECTIONS
# ============================================
input -> parser: parse {
  style.stroke-width: 2
}

parser -> context: events {
  style.stroke-width: 2
}

context -> rich: build {
  style.stroke-width: 2
}

rich -> commentary: prompt {
  style.stroke-width: 2
}

commentary -> tts: text {
  style.stroke-width: 2
}

tts -> output: synthesize {
  style.stroke-width: 2
}

rich -> future: embed {
  style: {
    stroke: "#9e9e9e"
    stroke-dash: 5
  }
}

future -> commentary: "reminds me of..." {
  style: {
    stroke: "#9e9e9e"
    stroke-dash: 5
  }
}
